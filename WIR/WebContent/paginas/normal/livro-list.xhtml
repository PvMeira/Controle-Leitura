<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/WEB-INF/modelo/padrao.xhtml">

	
<ui:define name="center">	
<b:panel title="Meus Livros " collapsible="false" >
		<h:form prependId="false" id="formListaLivrosUsuario">
		<p:panelGrid columns="3" >
			<p:splitButton 
				value="Operações em Lote " 
				style="text-align: center">
				<p:menuitem 
					style="text-align: center"
					value="Deletar" 
					oncomplete="updateTabelaLivro()"
					action="#{livroMB.deletarEmLote()}"
					icon="fa fa-fw fa-trash"/>
				<p:menuitem 
					style="text-align: center"
					value="Baixar" 
					icon="fa fa-fw fa-arrow-down"/>
			</p:splitButton>	
		<p:commandButton id="buttonNovoLivro" 
					action="livro-form.xhtml?faces-redirect=true"
					icon="fa fa-fw fa-book"  
					value="Novo"/>
		<p:commandButton id="buttonNovaLeitura" 
					oncomplete="PF('novaLeituraLista').show();"
					icon="fa fa-fw fa-plus"  
					value="Nova Leitura"/>
		</p:panelGrid>		
			<br/>
			<br/>
			<p:dataTable id="listaLivrosUsuario"
					var="livro" 
					disabledSelection="false"
					value="#{livroMB.listaLivrosPessoaLogada()}"
					emptyMessage="Não existe cadastros" 
					rowKey="#{livro.idLivro}"
					selection="#{livroMB.livrosSelecionados}"
					paginator="true" rows="5"
					draggableColumns="true" 
					paginatorAlwaysVisible="true" >
					
				<p:column selectionMode="multiple" style="width:60px;text-align:center"/>	
				<p:column headerText="Titulo" style="text-align:center">
					<h:outputText value="#{livro.titulo}"/>
				</p:column>
				
				<p:column headerText="Autor" style="text-align:center">
					<h:outputText value="#{livro.autor}"/>
				</p:column>
				
				<p:column headerText="Paginas" style="text-align:center">
					<h:outputText value="#{livro.paginas}"/>
				</p:column>
				
				<p:column headerText="Status" style="text-align:center">
					<h:outputText value="#{livroMB.VerificaStatusLivro(livro)}"/>
				</p:column>
				
				<p:column headerText="Pontuação" style="text-align:center">
					<p:rating value="#{livro.pontuacao}" 
							  cancel="false"
							  id="idPontuacao">
						  <p:ajax event="rate" listener="#{livroMB.updatePontuacaoLivro}" onstart="#{livroMB.populaObservacaoParaModal(livro)}"/>
					</p:rating>
				</p:column>
				
				<p:column headerText="Ação" style="text-align:center">	
				
				<!-- Botao para modal Resumo -->
				<p:commandLink 
				id="comandLinkModalResumo"
				title="Visualizar ou Alterar Resumo"
				action="#{livroMB.populaObservacaoParaModal(livro)}"
				oncomplete="PF('modalResumo').show();">
				
				<p:graphicImage value="/resources/imagens/nota.png" 
					height="20px" width="20px"/>
					
				</p:commandLink>
				<!-- Botao para downlaod do pdf -->
				<p:commandLink
				id="comandLinkDownlod"
				ajax="false"
				title="Baixar livro">
				   <p:fileDownload value="#{livroMB.FileDownloadView(livro)}" />
				<p:graphicImage value="/resources/imagens/download.png"
				height="15px" width="15px"/>
				</p:commandLink>
				</p:column>				
			</p:dataTable>
			<p:remoteCommand name="updateTabelaLivro" update="listaLivrosUsuario"/>
		</h:form>
		</b:panel>
		
		<!-- Modal para realizar nova Leitura -->
		<ui:include src="/paginas/normal/livro-modal-novaLeitura.xhtml"/>
		<!-- Modal Resumo -->
		<ui:include src="/paginas/normal/livro-modal-resumo.xhtml" />

	
		<p:confirmDialog id="idModalConfirmDialog"
		widgetVar="modalconfirmaExluir"
		appendTo="@(body)"
		width="600px"
		height="40px"
		global="true"
		closable="true"
		header="Deseja deletar deletar esse livro?"
		message="Clique em Sim para deletar esse livro dos seus livros, ou cancelar para sair"
		closeOnEscape="false">
		<p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
        <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" style="  float: right;"/>
		
		</p:confirmDialog>
		
		</ui:define>
</ui:composition>