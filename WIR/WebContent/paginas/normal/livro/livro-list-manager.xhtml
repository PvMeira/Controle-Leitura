<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui" xmlns:b="http://bootsfaces.net/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/WEB-INF/modelo/padrao.xhtml"
	xmlns:pe="http://primefaces.org/ui/extensions">

	<ui:define name="center">
			<p:panel id="basicManagerLivros" header="Meus Livros"  style="margin-bottom:20px">
			<p:tabView dynamic="true" cache="true" >
				<p:tab title="Meus Livros Atuais ">
					
					<p:panel id="livrosUsuariosAtuais"  >
							<h:form prependId="false" id="formListaLivrosUsuario">
								<p:panelGrid columns="3">
									<p:splitButton value="Operações em Lote "
										style="text-align: center">
										<p:menuitem style="text-align: center" value="Deletar"
											oncomplete="updateTabelaLivro()"
											action="#{livroMB.deletarEmLote()}" 
											icon="fa fa-fw fa-trash" />
										<p:menuitem style="text-align: center" value="Baixar"
											ajax="false" icon="fa fa-fw fa-arrow-down">
											<p:fileDownload value="#{livroMB.geradorZip()}" />
										</p:menuitem>
									</p:splitButton>
									<p:commandButton id="buttonNovoLivro"
										action="livro-form.xhtml?faces-redirect=true"
										icon="fa fa-fw fa-book" value="Novo Livro" />
									<p:commandButton id="buttonNovaLeitura"
										oncomplete="PF('novaLeituraLista').show();"
										icon="fa fa-fw fa-leanpub" value="Nova Leitura" />
								</p:panelGrid>
								<br />
								<br />
								<p:dataTable id="listaLivrosUsuario" var="livro"
									disabledSelection="false"
									value="#{livroMB.listaLivrosPessoaLogada()}"
									emptyMessage="Não existe cadastros" rowKey="#{livro.idLivro}"
									selection="#{livroMB.livrosSelecionados}" paginator="true"
									rows="10" draggableColumns="true" paginatorAlwaysVisible="true">

									<p:column selectionMode="multiple"
										style="width:60px;text-align:center" />
									<p:column headerText="Titulo" style="text-align:center">
										<h:outputText value="#{livro.titulo}" />
									</p:column>

									<p:column headerText="Autor" style="text-align:center">
										<h:outputText value="#{livro.autor}" />
									</p:column>

									<p:column headerText="Paginas" style="text-align:center">
										<h:outputText value="#{livro.paginas}" />
									</p:column>

									<p:column headerText="Status" style="text-align:center">
										<h:outputText value="#{livroMB.VerificaStatusLivro(livro)}" />
									</p:column>

									<p:column headerText="Pontuação" style="text-align:center">
										<p:rating value="#{livro.pontuacao}" cancel="false"
											id="idPontuacao">
											<p:ajax event="rate"
												listener="#{livroMB.updatePontuacaoLivro}"
												onstart="#{livroMB.populaObservacaoParaModal(livro)}" />
										</p:rating>
									</p:column>

									<p:column headerText="Ação" style="text-align:center">
										<!-- Botao para modal Resumo -->
										<p:commandLink id="comandLinkModalResumo"
											title="Visualizar ou Alterar Resumo"
											action="#{livroMB.populaObservacaoParaModal(livro)}"
											oncomplete="PF('modalResumo').show();">

											<p:graphicImage value="/resources/imagens/nota.png" height="20px" width="20px" />
										</p:commandLink>
										
										<!-- Botao para downlaod do pdf -->
										<p:commandLink id="comandLinkDownlod"  ajax="false"  title="Baixar livro">
											<p:fileDownload value="#{livroMB.FileDownloadView(livro)}" />
											<p:graphicImage value="/resources/imagens/download.png" height="15px" width="15px" />
										</p:commandLink>
										
												<!-- Botao para ler este livro em especifico -->
										<p:commandLink id="comandLinkLerLivro"
											rendered="#{livroMB.VerificaStatusLivro(livro) eq 'Livro não Lido' or 'Livro já Lido'}"
											title="Começar a ler este livro"
											action="#{livroMB.iniciarLeituraLivroInline(livro)}"
											oncomplete="updateTabelaLivro();">
											<p:graphicImage value="/resources/imagens/livro_lendo.png" height="30px" width="30px" />
										</p:commandLink>
										<p:menuButton value="Mais">
										<p:menuitem value="Editar" oncomplete="PF('editarLivro').show();" action="#{livroMB.populaLivroEdicao(livro)}"/>
										<p:menuitem value="Deletar"  action="#{livroMB.deletar(livro)}"/>
										</p:menuButton>
										
									</p:column>
								</p:dataTable>
								<p:remoteCommand name="updateTabelaLivro" update="listaLivrosUsuario" />
							</h:form>
						</p:panel>
				
				</p:tab>
				<p:tab title="Minhas leituras Atuais">
					<h:form prependId="false" id="idform02">
						<p:dataTable id="listaDelivrosAtuais" var="livros"
							value="#{leituraMB.listaTodasLeiturasPessoaLogada()}"
							rowKey="#{livros.idLeitura}" emptyMessage="Não existe cadastros"
							paginator="true" rows="10" sortMode="multiple"
							draggableColumns="true" paginatorAlwaysVisible="true">

							<p:column headerText="Titulo" style="text-align:center"
								sortBy="#{livros.livro.titulo}">
								<h:outputText value="#{livros.livro.titulo}" />
							</p:column>

							<p:column headerText="Data de Inicio" style="text-align:center"
								sortBy="#{livros.dataInicio.time}">
								<h:outputText value="#{livros.dataInicio.time}">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>
							</p:column>

							<p:column headerText="Pagina Atual" style="text-align:center"
								sortBy="#{livros.paginaAtual}">
								<p:inplace id="ajaxEdit" editor="true">
									<p:inputText value="#{livros.paginaAtual}" 
										required="true"
										label="text" 
										onchange="atualizarlistaLeitura();" />
								</p:inplace>

								<h:outputText />
							</p:column>

							<p:column headerText="Ações" style="text-align:center">
								<p:commandLink id="modalObservacao" title="Abrir observação"
									action="#{leituraMB.leitura.setObservacao(livros.observacao)}"
									oncomplete="PF('modalLembrete').show();">
									<p:ajax event="click"
										listener="#{leituraMB.populaLeituraParaObservacao(livros)}" />
									<p:graphicImage value="/resources/imagens/nota.png"
										height="20px" width="20px" />
								</p:commandLink>
							<p:commandLink id="sfsfsfsf">
									
							<p:graphicImage url="/resources/imagens/icone_pdf.jpg" style="width: 15px;"/>
						</p:commandLink>
								<p:commandLink id="paraLeitura" title="Para a leitura atual"
									action="#{leituraMB.pararLeitura(livros)}"
									update="listaDelivrosAtuais"
									oncomplete="updateTabelaLivro();">
									<p:confirm />
									<p:graphicImage value="/resources/imagens/parar_leitura.png"
										height="20px" width="20px" />
								</p:commandLink>
							</p:column>
						</p:dataTable>
						<p:remoteCommand name="atualizarlistaLeitura" update="listaDelivrosAtuais" />
					</h:form>

				</p:tab>
				<p:tab title="Listas Personalizadas">
					<h:form prependId="false" id="idAbaTresForm">

						<p:commandButton id="idButtonGerarListaCustomizada"
							value="Nova Lista Personalizada" 
							oncomplete="PF('novaLeituraListaModal').show();"/>
							
						<p:dataTable id="listaCustomList" var="listaCustom"
							value="#{listaCustomizadaMB.listarTodasListasCustomizadas()}"
							emptyMessage="Não existe cadastros"
							paginator="true"
							rows="20" 
							paginatorAlwaysVisible="true">
							 	<p:column>
         						 	 <p:rowToggler/>
         						  </p:column>
								<p:column headerText="Nome Lista" style="text-align:center">
									<h:outputText value="#{listaCustom.nomeLista}"/>	
								</p:column>
								<p:column headerText="Tipo " style="text-align:center">
									<h:outputText value="#{listaCustom.tipoLista}"/>	
								</p:column>
								<p:column headerText="Livros na lista" style="text-align:center">
									<h:outputText value="#{listaCustom.livro.size()}"/>
								</p:column>
								<p:column headerText="Data de Criação" style="text-align:center">
									<h:outputText value="#{listaCustom.dataInclusao.time}">
										<f:convertDateTime pattern="dd/MM/yyyy" />
									</h:outputText>
								</p:column>
								<p:column headerText="Criador" style="text-align:center">
									<h:outputText value="#{listaCustom.pessoa.nome}"/>
								</p:column>
								<p:column>
									<p:commandButton id="buttonDeleteList"  icon="fa fa-fw fa-trash"/>
								</p:column>
						 <p:rowExpansion >
						 							<!-- SUBTABELA -->
						 	<p:subTable id="subListaCustom" value="#{listaCustom.livro}" var="subLista">
						 		<p:column  style="text-align:center" footerText="Nome">
									<h:outputText value="#{subLista.titulo}"/>	
								</p:column>
								<p:column  style="text-align:center" footerText="Autor">
									<h:outputText value="#{subLista.autor}"/>	
								</p:column>
								<p:column  style="text-align:center" footerText="Pontuação">
									<p:rating value="#{subLista.pontuacao}" cancel="false" id="idPontuacao" />
								</p:column>
						 	</p:subTable>
						 </p:rowExpansion>		
						</p:dataTable>
						<p:remoteCommand name="updateListaCustom" update="listaCustomList"/>
					</h:form>
				</p:tab>
			</p:tabView>
		</p:panel>
	
			<!-- Imports TAB 01 -->
			<p:confirmDialog id="idModalConfirmDialogExcluirLivro"
				widgetVar="modalconfirmaExluir"
				appendTo="@(body)"
				width="600px"
				height="40px"
				global="true"
				closable="true"
				header="Deseja deletar deletar esse livro?"
				message="Clique em Sim para deletar esse livro dos seus livros, ou cancelar para sair"
			closeOnEscape="false">
			<p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
	        <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" style="  float: right;"/>
			
			</p:confirmDialog>	
			<!-- Modal para realizar nova Leitura -->
			<ui:include src="/paginas/normal/livro/livro-modal-novaLeitura.xhtml"/>
			<!-- Modal Resumo -->
			<ui:include src="/paginas/normal/livro/livro-modal-resumo.xhtml" />
			
			<!-- Modal Edit Livro -->
			<ui:include src="/paginas/normal/livro/modal-edit-livro.xhtml" />
		<!-- Imports TAB 02 -->
		
			<!-- Modal para visualizar anotação -->
			<ui:include src="/paginas/normal/livro/livros-atuais-lembrete-modal.xhtml"/> 
			<p:confirmDialog 
				id="idModalConfirmDialogLeitura2"
				widgetVar="modalconfirmaExluir"
				appendTo="@(body)"
				width="600px"
				height="40px"
				global="true"
				closable="true"
				header="Deseja Parar a Leitura?"
				message="Para para a leitura desse livro clique em Sim ou em Cancelar para fechar esta janela"
				closeOnEscape="false">
					<p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
	       			<p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" style="  float: right;"/>
			
			</p:confirmDialog>
		<!-- Imports TAB 03 -->
		<!-- Modal Criar Lista Personalizada para livros -->
		<ui:include src="/paginas/normal/livro/livros-personalizados-modal.xhtml" />
	</ui:define>
</ui:composition>