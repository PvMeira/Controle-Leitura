<!doctype html>
<html ng-app>
	<head>
		<title>Lista de compras com AngularJS</title>
    <meta charset="utf-8">
		<link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/lista-compras.css">
		<script src="lib/angular-1.0.1.js"></script>
		
	</head>
	<body>
		<div class="container" ng-controller="livroController">
			<div class="row">
				<div class="page-header">
					<h1>Lista de livros Disponiveis Grátis em : </h1>
				</div>
			</div>
			<div class="row">
			
	<table  cellpadding="2" cellspacing="2" border="1">
			<tr>
			<th>Título</th>
			<th>Nome Autor</th>
			<th>Nome Dono</th>
			<th>Pontuação</th>
			<th>Páginas</th>
			<tr>
    <tr ng-repeat="livro in listaLivro">
        <td> {{livro.nomeLivro}} </td>
        <td> {{livro.nomeAutor}} </td>
        <td> {{livro.nomeDono}} </td>
		<td> {{livro.paginas}} </td>
        <td> {{livro.pontuacao}} </td>
    </tr>
	</table>
     
			</div>
		</div>
	</body>
	
<script type="text/javascript">
   
   /* Service App */
var myapp = angular.module('myapp', []);

/* Service Comum */
myapp.factory("$comum", function($http, $q) {
    function ajax(url, parametros, metodo) {
        var requisicao = $http({
            method: metodo,
            url: url,
            data:parametros
        });

        var promessa = requisicao.then(
            function(resposta) {
                console.log("Retorno: " + resposta);
                return(resposta.data);
            },
            function(resposta) {
                console.log("Erro ao executar: " + resposta);
                return($q.reject("Something went wrong"));
            }
        );
        return promessa;
    }
    return({
        ajax:ajax
    });
});

/* Service Agenda */
myapp.factory("$livro", function($comum) {
    return {
        buscar : function(filtro) {
            var promessa = $comum.ajax("/CL/ws/livros/, "", "GET");
            return promessa;
        }
    };
});

/* Controller */
myapp.controller('livroController', function($scope, $livro) {
    $livro.listAll().then(function(req) {
        $scope.listaLivro = req;
    });
});

</script>	
</html>
